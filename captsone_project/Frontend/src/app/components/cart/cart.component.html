<h2 class="mb-4">Shopping Cart</h2>
@if (cartItems.length === 0) {
  <div class="alert alert-info">
    <i class="bi bi-cart-x"></i> Your cart is empty. <a routerLink="/products">Continue shopping</a>
  </div>
} @else {
  <div class="table-responsive">
    <table class="table table-striped">
      <thead>
        <tr>
          <th>Image</th>
          <th>Product</th>
          <th>Category</th>
          <th>Manufacturer</th>
          <th>UOM</th>
          <th>Rating</th>
          <th>Manufacture Date</th>
          <th>Price</th>
          <th>Quantity</th>
          <th>Total</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        @for (item of cartItems; track item.product.id) {
          <tr>
            <td>
              @if (item.product.imageUrl) {
                <img [src]="item.product.imageUrl" [alt]="item.product.name" class="product-thumb" (error)="handleImageError($event)">
                <div class="image-placeholder-small" style="display: none;">No Image</div>
              } @else {
                <div class="image-placeholder-small">No Image</div>
              }
            </td>
            <td>{{ item.product.name }}</td>
            <td>{{ item.product.category }}</td>
            <td>{{ item.product.manufacturer || 'N/A' }}</td>
            <td>{{ item.product.uom || 'N/A' }}</td>
            <td>{{ item.product.rating ? (item.product.rating + '/5') : 'N/A' }}</td>
            <td>{{ item.product.manufactureDate ? (item.product.manufactureDate | date:'shortDate') : 'N/A' }}</td>
            <td>${{ item.product.price | number:'1.2-2' }}</td>
            <td>
              <div class="input-group" style="width: 120px;">
                <button class="btn btn-outline-secondary" (click)="updateQuantity(item, item.quantity - 1)">-</button>
                <input type="number" class="form-control text-center" [value]="item.quantity" readonly>
                <button class="btn btn-outline-secondary" (click)="updateQuantity(item, item.quantity + 1)">+</button>
              </div>
            </td>
            <td>${{ item.product.price * item.quantity | number:'1.2-2' }}</td>
            <td>
              <button class="btn btn-danger btn-sm" (click)="removeFromCart(item)">
                <i class="bi bi-trash"></i> Remove
              </button>
            </td>
          </tr>
        }
      </tbody>
      <tfoot>
        <tr>
          <td colspan="9" class="text-end"><strong>Total:</strong></td>
          <td><strong>${{ totalAmount | number:'1.2-2' }}</strong></td>
          <td></td>
        </tr>
      </tfoot>
    </table>
  </div>
  <div class="text-end">
    <button class="btn btn-success btn-lg" (click)="checkout()" [disabled]="isLoading">
      <i class="bi bi-credit-card"></i> Checkout
    </button>
  </div>
}